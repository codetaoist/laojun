# å¤ªä¸Šè€å›(Laojun) Goä¼ä¸šçº§åˆ†æ¨¡å—æ¶æ„åˆ†ææŠ¥å‘Š

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç›®å½•ç»“æ„æ·±åº¦è§£æ](#ç›®å½•ç»“æ„æ·±åº¦è§£æ)
3. [æŠ€æœ¯æ¶æ„åˆ†æ](#æŠ€æœ¯æ¶æ„åˆ†æ)
4. [æ¨¡å—ä¾èµ–å…³ç³»](#æ¨¡å—ä¾èµ–å…³ç³»)
5. [æ’ä»¶å¸‚åœºä¸æ€»åå°è¡”æ¥æ–¹æ¡ˆ](#æ’ä»¶å¸‚åœºä¸æ€»åå°è¡”æ¥æ–¹æ¡ˆ)
6. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
7. [æ¶æ„æ”¹è¿›å»ºè®®](#æ¶æ„æ”¹è¿›å»ºè®®)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

å¤ªä¸Šè€å›(Laojun)æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„é¡¹ç›®ï¼Œé‡‡ç”¨åˆ†æ¨¡å—è®¾è®¡ï¼ŒåŒ…å«æ’ä»¶å¸‚åœºã€ç®¡ç†åå°ã€æœåŠ¡å‘ç°ã€ç½‘å…³ã€ç›‘æ§ç­‰å¤šä¸ªæ ¸å¿ƒæ¨¡å—ã€‚é¡¹ç›®éµå¾ªDDD(é¢†åŸŸé©±åŠ¨è®¾è®¡)å’ŒClean ArchitectureåŸåˆ™ï¼Œå…·æœ‰é«˜å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„è®¾è®¡
- ğŸ”Œ æ’ä»¶åŒ–ç³»ç»Ÿ
- ğŸ›¡ï¸ å®Œæ•´çš„æƒé™ç®¡ç†
- ğŸ“Š å®æ—¶ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- ğŸš€ é«˜æ€§èƒ½ç½‘å…³
- ğŸ“¦ å®¹å™¨åŒ–éƒ¨ç½²

## ğŸ—ï¸ ç›®å½•ç»“æ„æ·±åº¦è§£æ

### 1. laojun-admin-api (ç®¡ç†åå°API)

**åŠŸèƒ½å®šä½**: æä¾›ç³»ç»Ÿç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€æ’ä»¶å®¡æ ¸ç­‰åå°ç®¡ç†åŠŸèƒ½çš„APIæœåŠ¡

**æŠ€æœ¯æ¶æ„**:
- **æ¡†æ¶**: Gin Web Framework
- **æ•°æ®åº“**: PostgreSQL + GORM
- **ç¼“å­˜**: Redis
- **è®¤è¯**: JWT + RBACæƒé™æ¨¡å‹
- **ç›‘æ§**: Prometheus + ç³»ç»ŸæŒ‡æ ‡æ”¶é›†

**æ ¸å¿ƒç»„ä»¶**:
```
laojun-admin-api/
â”œâ”€â”€ cmd/                    # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ handlers/          # HTTPå¤„ç†å™¨
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â””â”€â”€ config/            # é…ç½®ç®¡ç†
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â””â”€â”€ docs/                  # APIæ–‡æ¡£
```

**å…³é”®ç®—æ³•å®ç°**:
- RBACæƒé™éªŒè¯ç®—æ³•
- æ’ä»¶å®¡æ ¸å·¥ä½œæµå¼•æ“
- ç³»ç»Ÿèµ„æºç›‘æ§ç®—æ³•

**æ€§èƒ½ä¼˜åŒ–ç‚¹**:
- Redisç¼“å­˜ç”¨æˆ·æƒé™ä¿¡æ¯
- æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–

### 2. laojun-marketplace-api (æ’ä»¶å¸‚åœºAPI)

**åŠŸèƒ½å®šä½**: æ’ä»¶å¸‚åœºçš„æ ¸å¿ƒAPIæœåŠ¡ï¼Œæä¾›æ’ä»¶å±•ç¤ºã€æœç´¢ã€è´­ä¹°ã€è¯„ä»·ç­‰åŠŸèƒ½

**æŠ€æœ¯æ¶æ„**:
- **æ¡†æ¶**: Gin Web Framework
- **æ•°æ®åº“**: PostgreSQL + GORM
- **æœç´¢**: å…¨æ–‡æœç´¢ + åˆ†ç±»ç­›é€‰
- **æ”¯ä»˜**: é›†æˆæ”¯ä»˜ç½‘å…³
- **æ–‡ä»¶å­˜å‚¨**: å¯¹è±¡å­˜å‚¨æœåŠ¡

**æ ¸å¿ƒç»„ä»¶**:
```go
// æ’ä»¶æœåŠ¡æ ¸å¿ƒæ¥å£
type PluginService interface {
    GetPlugins(params PluginSearchParams) ([]Plugin, PaginationMeta, error)
    GetPlugin(id uuid.UUID) (*Plugin, error)
    CreatePlugin(plugin *Plugin) error
    UpdatePlugin(id uuid.UUID, plugin *Plugin) error
    PurchasePlugin(userID, pluginID uuid.UUID) error
}
```

**æ•°æ®æµè®¾è®¡**:
```
ç”¨æˆ·è¯·æ±‚ â†’ APIç½‘å…³ â†’ æ’ä»¶å¸‚åœºAPI â†’ ä¸šåŠ¡æœåŠ¡å±‚ â†’ æ•°æ®è®¿é—®å±‚ â†’ PostgreSQL
                                    â†“
                               Redisç¼“å­˜å±‚
```

**å…³é”®ç®—æ³•å®ç°**:
- æ’ä»¶æœç´¢æ’åºç®—æ³•(ç›¸å…³æ€§ + è¯„åˆ† + ä¸‹è½½é‡)
- æ¨èç®—æ³•(ååŒè¿‡æ»¤)
- è¯„åˆ†è®¡ç®—ç®—æ³•

### 3. laojun-plugins (æ’ä»¶ç³»ç»Ÿ)

**åŠŸèƒ½å®šä½**: æ’ä»¶å¼€å‘æ¡†æ¶å’Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œæä¾›æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æŠ€æœ¯æ¶æ„**:
- **æ’ä»¶åŠ è½½**: åŠ¨æ€åŠ è½½æœºåˆ¶
- **æ²™ç®±ç¯å¢ƒ**: å®‰å…¨éš”ç¦»
- **ç”Ÿå‘½å‘¨æœŸ**: æ³¨å†Œâ†’åŠ è½½â†’è¿è¡Œâ†’å¸è½½
- **é€šä¿¡æœºåˆ¶**: äº‹ä»¶æ€»çº¿ + RPC

**æ ¸å¿ƒç»„ä»¶**:
```go
// æ’ä»¶æ³¨å†Œä¸­å¿ƒ
type PluginRegistry interface {
    Register(plugin Plugin) error
    Unregister(pluginID string) error
    GetPlugin(pluginID string) (Plugin, error)
    ListPlugins() []Plugin
}

// æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
type PluginManager interface {
    Load(pluginPath string) error
    Start(pluginID string) error
    Stop(pluginID string) error
    Unload(pluginID string) error
}
```

**å®‰å…¨æœºåˆ¶**:
- ä»£ç ç­¾åéªŒè¯
- æƒé™æ²™ç®±éš”ç¦»
- èµ„æºä½¿ç”¨é™åˆ¶
- æ¶æ„ä»£ç æ£€æµ‹

### 4. laojun-gateway (APIç½‘å…³)

**åŠŸèƒ½å®šä½**: ç»Ÿä¸€APIå…¥å£ï¼Œæä¾›è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€é™æµã€è®¤è¯ç­‰åŠŸèƒ½

**æŠ€æœ¯æ¶æ„**:
- **è·¯ç”±**: åŸºäºè·¯å¾„å’ŒHeaderçš„æ™ºèƒ½è·¯ç”±
- **è´Ÿè½½å‡è¡¡**: è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥
- **é™æµ**: ä»¤ç‰Œæ¡¶ç®—æ³•
- **ç†”æ–­**: Circuit Breakeræ¨¡å¼
- **æœåŠ¡å‘ç°**: Consulé›†æˆ

**æ ¸å¿ƒç»„ä»¶**:
```go
// ç½‘å…³æ ¸å¿ƒæ¥å£
type Gateway interface {
    Route(request *http.Request) (*http.Response, error)
    AddRoute(route Route) error
    RemoveRoute(routeID string) error
    UpdateRoute(routeID string, route Route) error
}

// ä¸­é—´ä»¶é“¾
type MiddlewareChain []Middleware
```

**æ€§èƒ½ä¼˜åŒ–ç‚¹**:
- è¿æ¥æ± å¤ç”¨
- å“åº”ç¼“å­˜
- å‹ç¼©ä¼ è¾“
- å¼‚æ­¥æ—¥å¿—è®°å½•

### 5. laojun-discovery (æœåŠ¡å‘ç°)

**åŠŸèƒ½å®šä½**: å¾®æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œæä¾›æœåŠ¡å¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡

**æŠ€æœ¯æ¶æ„**:
- **æ³¨å†Œä¸­å¿ƒ**: åŸºäºRedisçš„åˆ†å¸ƒå¼æ³¨å†Œä¸­å¿ƒ
- **å¥åº·æ£€æŸ¥**: HTTP/TCPå¥åº·æ£€æŸ¥
- **è´Ÿè½½å‡è¡¡**: å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»

**æ ¸å¿ƒç»„ä»¶**:
```go
// æœåŠ¡æ³¨å†Œæ¥å£
type ServiceRegistry interface {
    Register(service ServiceInfo) error
    Deregister(serviceID string) error
    Discover(serviceName string) ([]ServiceInfo, error)
    Watch(serviceName string) (<-chan []ServiceInfo, error)
}
```

### 6. laojun-monitoring (ç›‘æ§ç³»ç»Ÿ)

**åŠŸèƒ½å®šä½**: ç³»ç»Ÿç›‘æ§ã€æŒ‡æ ‡æ”¶é›†ã€å‘Šè­¦é€šçŸ¥

**æŠ€æœ¯æ¶æ„**:
- **æŒ‡æ ‡æ”¶é›†**: Prometheus + è‡ªå®šä¹‰æŒ‡æ ‡
- **ç³»ç»Ÿç›‘æ§**: CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
- **åº”ç”¨ç›‘æ§**: QPSã€å»¶è¿Ÿã€é”™è¯¯ç‡
- **å‘Šè­¦**: åŸºäºè§„åˆ™çš„å‘Šè­¦ç³»ç»Ÿ

**æ ¸å¿ƒæŒ‡æ ‡**:
- ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡
- APIå“åº”æ—¶é—´å’ŒQPS
- æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
- ç¼“å­˜å‘½ä¸­ç‡

### 7. laojun-config-center (é…ç½®ä¸­å¿ƒ)

**åŠŸèƒ½å®šä½**: é›†ä¸­åŒ–é…ç½®ç®¡ç†ï¼Œæ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°

**æŠ€æœ¯æ¶æ„**:
- **é…ç½®å­˜å‚¨**: åˆ†å±‚é…ç½®å­˜å‚¨
- **åŠ¨æ€æ›´æ–°**: WebSocketæ¨é€
- **ç‰ˆæœ¬ç®¡ç†**: é…ç½®ç‰ˆæœ¬æ§åˆ¶
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦æƒé™ç®¡ç†

### 8. laojun-shared (å…±äº«åº“)

**åŠŸèƒ½å®šä½**: æä¾›é€šç”¨ç»„ä»¶å’Œå·¥å…·åº“

**æ ¸å¿ƒæ¨¡å—**:
- **è®¤è¯**: JWTå¤„ç†ã€æƒé™éªŒè¯
- **æ•°æ®åº“**: è¿æ¥ç®¡ç†ã€äº‹åŠ¡å¤„ç†
- **ç¼“å­˜**: Redisæ“ä½œå°è£…
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—
- **å·¥å…·**: ä»£ç ç”Ÿæˆã€é™æ€æ£€æŸ¥

## ğŸ”§ æŠ€æœ¯æ¶æ„åˆ†æ

### åˆ†å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç¤ºå±‚ (Presentation Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Gateway â”‚ Admin Web â”‚ Marketplace Web â”‚ Mobile App     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Admin API â”‚ Marketplace API â”‚ Plugin API â”‚ Config API      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡å±‚ (Business Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User Service â”‚ Plugin Service â”‚ Review Service â”‚ Auth Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (Data Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL â”‚ Redis â”‚ Object Storage â”‚ Message Queue        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆç»„æˆ

**åç«¯æŠ€æœ¯æ ˆ**:
- **è¯­è¨€**: Go 1.21
- **Webæ¡†æ¶**: Gin
- **ORM**: GORM
- **æ•°æ®åº“**: PostgreSQL
- **ç¼“å­˜**: Redis
- **æ¶ˆæ¯é˜Ÿåˆ—**: Redis Streams
- **æœåŠ¡å‘ç°**: Consul
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: Zap + Lumberjack

**å‰ç«¯æŠ€æœ¯æ ˆ**:
- **æ¡†æ¶**: React + TypeScript
- **çŠ¶æ€ç®¡ç†**: Zustand
- **UIç»„ä»¶**: Ant Design
- **æ„å»ºå·¥å…·**: Vite
- **è·¯ç”±**: React Router

**åŸºç¡€è®¾æ–½**:
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ç¼–æ’**: Kubernetes
- **CI/CD**: GitHub Actions
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: ELK Stack

## ğŸ”— æ¨¡å—ä¾èµ–å…³ç³»

### ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    A[laojun-gateway] --> B[laojun-discovery]
    A --> C[laojun-admin-api]
    A --> D[laojun-marketplace-api]
    
    C --> E[laojun-shared]
    D --> E
    F[laojun-plugins] --> E
    G[laojun-monitoring] --> E
    H[laojun-config-center] --> E
    
    C --> I[laojun-plugins]
    D --> I
    
    B --> J[Redis]
    C --> K[PostgreSQL]
    D --> K
    C --> J
    D --> J
    
    G --> L[Prometheus]
    
    M[laojun-admin-web] --> C
    N[laojun-marketplace-web] --> D
```

### æ•°æ®æµå‘åˆ†æ

**ç”¨æˆ·è¯·æ±‚æµç¨‹**:
1. ç”¨æˆ·è¯·æ±‚ â†’ APIç½‘å…³
2. APIç½‘å…³ â†’ æœåŠ¡å‘ç° â†’ ç›®æ ‡æœåŠ¡
3. ç›®æ ‡æœåŠ¡ â†’ ä¸šåŠ¡é€»è¾‘å¤„ç†
4. ä¸šåŠ¡é€»è¾‘ â†’ æ•°æ®è®¿é—®å±‚
5. æ•°æ®è®¿é—®å±‚ â†’ æ•°æ®åº“/ç¼“å­˜
6. å“åº”åŸè·¯è¿”å›

**æ’ä»¶å®‰è£…æµç¨‹**:
1. ç”¨æˆ·é€‰æ‹©æ’ä»¶ â†’ æ’ä»¶å¸‚åœºAPI
2. æ’ä»¶å¸‚åœºAPI â†’ æ’ä»¶æœåŠ¡
3. æ’ä»¶æœåŠ¡ â†’ æ’ä»¶æ³¨å†Œä¸­å¿ƒ
4. æ’ä»¶æ³¨å†Œä¸­å¿ƒ â†’ æ’ä»¶ç®¡ç†å™¨
5. æ’ä»¶ç®¡ç†å™¨ â†’ åŠ è½½å¹¶å¯åŠ¨æ’ä»¶

## ğŸ”Œ æ’ä»¶å¸‚åœºä¸æ€»åå°è¡”æ¥æ–¹æ¡ˆ

### æ•´ä½“æ¶æ„è®¾è®¡

```mermaid
sequenceDiagram
    participant Dev as å¼€å‘è€…
    participant MP as æ’ä»¶å¸‚åœº
    participant Admin as æ€»åå°
    participant Plugin as æ’ä»¶ç³»ç»Ÿ
    
    Dev->>MP: æäº¤æ’ä»¶
    MP->>Admin: åŒæ­¥æ’ä»¶ä¿¡æ¯
    Admin->>Admin: è‡ªåŠ¨å®¡æ ¸
    Admin->>Admin: äººå·¥å®¡æ ¸
    Admin->>MP: è¿”å›å®¡æ ¸ç»“æœ
    MP->>Dev: é€šçŸ¥å®¡æ ¸ç»“æœ
    MP->>Plugin: å‘å¸ƒæ’ä»¶
    Plugin->>Admin: åŒæ­¥å®‰è£…ç»Ÿè®¡
```

### æ ¸å¿ƒæ¥å£è®¾è®¡

#### 1. æ’ä»¶æ³¨å†Œæœºåˆ¶

**å…ƒæ•°æ®æ ¼å¼**:
```json
{
  "plugin_id": "com.example.plugin",
  "name": "ç¤ºä¾‹æ’ä»¶",
  "version": "1.0.0",
  "description": "æ’ä»¶æè¿°",
  "author": "å¼€å‘è€…",
  "category": "å·¥å…·ç±»",
  "permissions": ["read", "write"],
  "dependencies": ["core@1.0.0"],
  "manifest": {
    "entry": "main.js",
    "config": "config.json",
    "assets": ["icon.png"]
  },
  "signature": "æ•°å­—ç­¾å"
}
```

**æ³¨å†Œæµç¨‹API**:
```http
POST /api/v1/plugins/register
Content-Type: application/json

{
  "metadata": {...},
  "package_url": "https://storage.example.com/plugin.zip",
  "checksum": "sha256:..."
}
```

#### 2. æƒé™æ§åˆ¶æ–¹æ¡ˆ

**RBACæ¨¡å‹è®¾è®¡**:
```go
type Permission struct {
    ID       string `json:"id"`
    Resource string `json:"resource"` // plugins, users, reviews
    Action   string `json:"action"`   // create, read, update, delete
    Scope    string `json:"scope"`    // own, all, department
}

type Role struct {
    ID          string       `json:"id"`
    Name        string       `json:"name"`
    Permissions []Permission `json:"permissions"`
}

type User struct {
    ID    string `json:"id"`
    Roles []Role `json:"roles"`
}
```

**æƒé™éªŒè¯ä¸­é—´ä»¶**:
```go
func RequirePermission(resource, action string) gin.HandlerFunc {
    return func(c *gin.Context) {
        user := getCurrentUser(c)
        if !hasPermission(user, resource, action) {
            c.JSON(403, gin.H{"error": "æƒé™ä¸è¶³"})
            c.Abort()
            return
        }
        c.Next()
    }
}
```

#### 3. é€šä¿¡åè®®é€‰æ‹©

**åè®®å¯¹æ¯”åˆ†æ**:

| åè®® | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| REST | ç®€å•æ˜“ç”¨ã€å¹¿æ³›æ”¯æŒ | æ€§èƒ½ä¸€èˆ¬ã€æ— çŠ¶æ€ | CRUDæ“ä½œã€å…¬å¼€API |
| gRPC | é«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨ | å¤æ‚åº¦é«˜ã€è°ƒè¯•å›°éš¾ | å†…éƒ¨æœåŠ¡é€šä¿¡ |
| WebSocket | å®æ—¶é€šä¿¡ã€åŒå‘ | è¿æ¥ç®¡ç†å¤æ‚ | å®æ—¶é€šçŸ¥ã€çŠ¶æ€åŒæ­¥ |

**æ¨èæ–¹æ¡ˆ**: REST + WebSocketæ··åˆæ¨¡å¼
- RESTç”¨äºæ ‡å‡†CRUDæ“ä½œ
- WebSocketç”¨äºå®æ—¶çŠ¶æ€åŒæ­¥å’Œé€šçŸ¥

#### 4. æ•°æ®åŒæ­¥ç­–ç•¥

**å¢é‡åŒæ­¥æœºåˆ¶**:
```go
type SyncEvent struct {
    ID        string    `json:"id"`
    Type      string    `json:"type"`      // create, update, delete
    Resource  string    `json:"resource"`  // plugin, user, review
    Data      any       `json:"data"`
    Timestamp time.Time `json:"timestamp"`
    Version   int64     `json:"version"`
}

func (s *SyncService) SyncChanges(lastVersion int64) ([]SyncEvent, error) {
    return s.db.GetEventsSince(lastVersion)
}
```

**å…¨é‡åŒæ­¥åœºæ™¯**:
- ç³»ç»Ÿåˆå§‹åŒ–
- æ•°æ®ä¸ä¸€è‡´ä¿®å¤
- å®šæœŸæ•°æ®æ ¡éªŒ

### APIè§„èŒƒè®¾è®¡

#### ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥
- URLç‰ˆæœ¬æ§åˆ¶: `/api/v1/`, `/api/v2/`
- å‘åå…¼å®¹æ€§ä¿è¯
- åºŸå¼ƒAPIçš„æ¸è¿›å¼è¿ç§»

#### é”™è¯¯ç è®¾è®¡
```go
const (
    // é€šç”¨é”™è¯¯ç  (1000-1999)
    ErrCodeSuccess         = 0
    ErrCodeInternalError   = 1000
    ErrCodeInvalidParam    = 1001
    ErrCodeUnauthorized    = 1002
    ErrCodeForbidden       = 1003
    
    // æ’ä»¶ç›¸å…³é”™è¯¯ç  (2000-2999)
    ErrCodePluginNotFound  = 2000
    ErrCodePluginExists    = 2001
    ErrCodePluginInvalid   = 2002
    
    // å®¡æ ¸ç›¸å…³é”™è¯¯ç  (3000-3999)
    ErrCodeReviewPending   = 3000
    ErrCodeReviewRejected  = 3001
)
```

#### å“åº”æ ¼å¼æ ‡å‡†
```json
{
  "code": 0,
  "message": "success",
  "data": {...},
  "timestamp": "2024-01-01T00:00:00Z",
  "request_id": "uuid"
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“ä¼˜åŒ–
1. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ å¤åˆç´¢å¼•
2. **åˆ†é¡µä¼˜åŒ–**: ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæ›¿ä»£OFFSETåˆ†é¡µ
3. **è¿æ¥æ± **: åˆç†é…ç½®æ•°æ®åº“è¿æ¥æ± å¤§å°
4. **è¯»å†™åˆ†ç¦»**: è¯»æ“ä½œä½¿ç”¨åªè¯»å‰¯æœ¬

### ç¼“å­˜ç­–ç•¥
1. **å¤šçº§ç¼“å­˜**: æœ¬åœ°ç¼“å­˜ + Redisç¼“å­˜
2. **ç¼“å­˜é¢„çƒ­**: ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
3. **ç¼“å­˜æ›´æ–°**: ä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼åŒæ­¥ç¼“å­˜
4. **ç¼“å­˜ç©¿é€**: å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€

### æœåŠ¡ä¼˜åŒ–
1. **è¿æ¥å¤ç”¨**: HTTPè¿æ¥æ± å¤ç”¨
2. **å¼‚æ­¥å¤„ç†**: è€—æ—¶æ“ä½œå¼‚æ­¥åŒ–
3. **æ‰¹é‡æ“ä½œ**: å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
4. **å‹ç¼©ä¼ è¾“**: å¯ç”¨gzipå‹ç¼©

## ğŸš€ æ¶æ„æ”¹è¿›å»ºè®®

### å¯æ‰©å±•æ€§æ”¹è¿›
1. **å¾®æœåŠ¡æ‹†åˆ†**: æŒ‰ä¸šåŠ¡åŸŸè¿›ä¸€æ­¥æ‹†åˆ†æœåŠ¡
2. **äº‹ä»¶é©±åŠ¨**: å¼•å…¥äº‹ä»¶æ€»çº¿è§£è€¦æœåŠ¡
3. **CQRS**: è¯»å†™åˆ†ç¦»æ¶æ„
4. **åˆ†å¸ƒå¼ç¼“å­˜**: Redisé›†ç¾¤éƒ¨ç½²

### å¯é æ€§æ”¹è¿›
1. **ç†”æ–­å™¨**: å®ç°æœåŠ¡ç†”æ–­æœºåˆ¶
2. **é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿é‡è¯•
3. **é™æµ**: å¤šç»´åº¦é™æµç­–ç•¥
4. **ç›‘æ§å‘Šè­¦**: å®Œå–„ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™

### å®‰å…¨æ€§æ”¹è¿›
1. **APIå®‰å…¨**: OAuth2.0 + JWT
2. **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
3. **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡
4. **å®‰å…¨æ‰«æ**: è‡ªåŠ¨åŒ–å®‰å…¨æ¼æ´æ‰«æ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024å¹´12æœˆ28æ—¥  
**ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: æ¶æ„åˆ†æå›¢é˜Ÿ