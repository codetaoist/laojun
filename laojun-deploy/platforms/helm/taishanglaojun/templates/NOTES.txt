🎉 太上老君微服务平台已成功部署！

📋 部署信息:
  Release Name: {{ .Release.Name }}
  Namespace: {{ .Release.Namespace }}
  Chart Version: {{ .Chart.Version }}
  App Version: {{ .Chart.AppVersion }}

🌐 访问地址:
{{- $domain := include "taishanglaojun.domain" . }}
{{- if .Values.ingress.enabled }}

  平台服务:
    主页面: http://{{ $domain }}
    API 网关: http://api.{{ $domain }}
    服务发现: http://api.{{ $domain }}/discovery
    监控接口: http://api.{{ $domain }}/monitoring

{{- if .Values.monitoring.enabled }}
  监控服务:
    监控总览: http://monitoring.{{ $domain }}
{{- if .Values.monitoring.prometheus.enabled }}
    Prometheus: http://prometheus.{{ $domain }}
{{- end }}
{{- if .Values.monitoring.grafana.enabled }}
    Grafana: http://grafana.{{ $domain }}
      用户名: {{ .Values.monitoring.grafana.admin.username }}
      密码: {{ .Values.monitoring.grafana.admin.password }}
{{- end }}
{{- if .Values.monitoring.jaeger.enabled }}
    Jaeger: http://jaeger.{{ $domain }}
{{- end }}
{{- if .Values.monitoring.kibana.enabled }}
    Kibana: http://kibana.{{ $domain }}
{{- end }}
{{- end }}

⚠️  请确保在本地 hosts 文件中添加以下条目:
{{- if eq .Values.ingress.className "nginx" }}
  # 获取 NGINX Ingress Controller 的外部 IP
  kubectl get svc -n ingress-nginx ingress-nginx-controller
{{- end }}

  # 添加到 hosts 文件 (Linux/macOS: /etc/hosts, Windows: C:\Windows\System32\drivers\etc\hosts)
  127.0.0.1 {{ $domain }}
  127.0.0.1 api.{{ $domain }}
{{- if .Values.monitoring.enabled }}
  127.0.0.1 monitoring.{{ $domain }}
{{- if .Values.monitoring.prometheus.enabled }}
  127.0.0.1 prometheus.{{ $domain }}
{{- end }}
{{- if .Values.monitoring.grafana.enabled }}
  127.0.0.1 grafana.{{ $domain }}
{{- end }}
{{- if .Values.monitoring.jaeger.enabled }}
  127.0.0.1 jaeger.{{ $domain }}
{{- end }}
{{- if .Values.monitoring.kibana.enabled }}
  127.0.0.1 kibana.{{ $domain }}
{{- end }}
{{- end }}

{{- else }}

  使用端口转发访问服务:
{{- if .Values.platform.enabled }}
  
  平台服务:
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-platform-discovery 8081:8081 -n {{ .Values.platform.namespace | default "taishanglaojun" }}
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-platform-monitoring 8082:8082 -n {{ .Values.platform.namespace | default "taishanglaojun" }}
{{- end }}

{{- if .Values.monitoring.enabled }}
  监控服务:
{{- if .Values.monitoring.prometheus.enabled }}
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-monitoring-prometheus 9090:9090 -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- if .Values.monitoring.grafana.enabled }}
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-monitoring-grafana 3000:3000 -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- if .Values.monitoring.jaeger.enabled }}
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-monitoring-jaeger 16686:16686 -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- if .Values.monitoring.kibana.enabled }}
    kubectl port-forward svc/{{ include "taishanglaojun.fullname" . }}-monitoring-kibana 5601:5601 -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- end }}
{{- end }}

🔧 管理命令:

  查看状态:
    helm status {{ .Release.Name }} -n {{ .Release.Namespace }}

  查看所有资源:
    helm get all {{ .Release.Name }} -n {{ .Release.Namespace }}

  查看日志:
{{- if .Values.platform.enabled }}
    kubectl logs -f deployment/{{ include "taishanglaojun.fullname" . }}-platform-discovery -n {{ .Values.platform.namespace | default "taishanglaojun" }}
    kubectl logs -f deployment/{{ include "taishanglaojun.fullname" . }}-platform-monitoring -n {{ .Values.platform.namespace | default "taishanglaojun" }}
{{- end }}
{{- if .Values.monitoring.enabled }}
{{- if .Values.monitoring.prometheus.enabled }}
    kubectl logs -f deployment/{{ include "taishanglaojun.fullname" . }}-monitoring-prometheus -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- if .Values.monitoring.grafana.enabled }}
    kubectl logs -f deployment/{{ include "taishanglaojun.fullname" . }}-monitoring-grafana -n {{ .Values.monitoring.namespace | default "taishanglaojun-monitoring" }}
{{- end }}
{{- end }}

  升级部署:
    helm upgrade {{ .Release.Name }} ./taishanglaojun -n {{ .Release.Namespace }}

  卸载部署:
    helm uninstall {{ .Release.Name }} -n {{ .Release.Namespace }}

📊 监控信息:
{{- if .Values.monitoring.enabled }}
{{- if .Values.monitoring.prometheus.enabled }}
  ✅ Prometheus 已启用 - 指标收集和存储
{{- end }}
{{- if .Values.monitoring.grafana.enabled }}
  ✅ Grafana 已启用 - 可视化仪表板
{{- end }}
{{- if .Values.monitoring.jaeger.enabled }}
  ✅ Jaeger 已启用 - 分布式链路追踪
{{- end }}
{{- if .Values.monitoring.influxdb.enabled }}
  ✅ InfluxDB 已启用 - 时序数据库
{{- end }}
{{- if .Values.monitoring.elasticsearch.enabled }}
  ✅ Elasticsearch 已启用 - 日志存储和搜索
{{- end }}
{{- if .Values.monitoring.kibana.enabled }}
  ✅ Kibana 已启用 - 日志分析和可视化
{{- end }}
{{- else }}
  ⚠️  监控栈未启用
{{- end }}

🔒 安全信息:
{{- if .Values.rbac.enabled }}
  ✅ RBAC 已启用
{{- end }}
{{- if .Values.networkPolicy.enabled }}
  ✅ 网络策略已启用
{{- end }}
{{- if .Values.podSecurityPolicy.enabled }}
  ✅ Pod 安全策略已启用
{{- end }}

💾 存储信息:
{{- if .Values.persistence.enabled }}
  ✅ 持久化存储已启用
  存储类: {{ include "taishanglaojun.storageClass" . | default "默认" }}
{{- else }}
  ⚠️  持久化存储未启用 - 数据将在 Pod 重启时丢失
{{- end }}

📚 更多信息:
  - 查看完整文档: https://github.com/codetaoist/laojun
  - Helm Chart 文档: ./helm/README.md
  - 故障排除指南: ./helm/README.md#故障排除

🎯 下一步:
  1. 验证所有 Pod 都在运行: kubectl get pods --all-namespaces
  2. 检查服务状态: kubectl get svc --all-namespaces
  3. 访问 Grafana 仪表板配置监控告警
  4. 查看 Jaeger 了解服务调用链路
  5. 使用 API 接口测试服务功能

感谢使用太上老君微服务平台！🚀